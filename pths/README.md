# Программа численного интегрирования с многопоточностью

Программа для вычисления определенного интеграла методом трапеций с поддержкой параллелизации по потокам (pthreads).

## Возможности

1. **Режим дискретных данных** - интегрирование по заданным точкам (x, y) с линейной интерполяцией
2. **Режим непрерывной функции** - интегрирование функции f(x) = sqrt(x) на заданном интервале
3. **Многопоточность** - автоматическое распараллеливание вычислений (по умолчанию 3 потока)

## Компиляция

```bash
cd /Users/ivan/CLionProjects/Phys_OS/pths
gcc -o itg.out integral.c -lm -lpthread
```

Или (если файл называется itg.c):
```bash
gcc -o itg.out itg.c -lm -lpthread
```

## Использование

### Режим 1: Дискретные данные

Интегрирование по заданным точкам с линейной интерполяцией.

**Формат:**
```bash
./itg.out n x1 x2 ... xn y1 y2 ... yn a b eps
```

**Параметры:**
- `n` - количество точек
- `x1 x2 ... xn` - координаты x (узлы интерполяции)
- `y1 y2 ... yn` - значения функции в точках
- `a b` - индексы начала и конца интегрирования (от 1)
- `eps` - требуемая точность

**Пример 1:**
```bash
# 5 точек: x = [0, 1, 2, 3, 4], y = [0, 1, 1.414, 1.732, 2]
# Интегрируем от индекса 1 до 5 с точностью 0.01
./itg.out 5 0 1 2 3 4 0 1 1.414 1.732 2 1 5 0.01
```

**Пример 2:**
```bash
# 10 точек для sqrt(x) от 0 до 9
./itg.out 10 0 1 2 3 4 5 6 7 8 9 0 1 1.414 1.732 2 2.236 2.449 2.646 2.828 3 1 10 0.001
```

### Режим 2: Непрерывная функция f(x) = sqrt(x)

Прямое вычисление интеграла непрерывной функции без дискретизации.

**Формат:**
```bash
./itg.out cont a b eps
```

**Параметры:**
- `cont` - ключевое слово для режима непрерывной функции
- `a b` - границы интервала интегрирования [a, b]
- `eps` - требуемая точность

**Пример 1:**
```bash
# Интеграл sqrt(x) от 1 до 4 с точностью 0.01
./itg.out cont 1 4 0.01
```

**Пример 2:**
```bash
# Интеграл sqrt(x) от 0 до 9 с точностью 0.001
./itg.out cont 0 9 0.001
```

**Пример 3:**
```bash
# Высокая точность
./itg.out cont 1 16 0.0001
```

## Как это работает

### Метод трапеций
Программа использует метод трапеций для численного интегрирования:
```
∫[a,b] f(x)dx ≈ Σ (f(x_i) + f(x_{i+1})) * h / 2
```

### Адаптивный шаг
Шаг интегрирования `h` вычисляется автоматически на основе:
- Оценки второй производной функции
- Требуемой точности `eps`
- Защиты от слишком маленького или большого шага

### Многопоточность
- Область интегрирования делится на подотрезки
- Каждый поток вычисляет интеграл на своем подотрезке
- Результаты суммируются в главном потоке
- Количество потоков: 3 (задается константой `pthread_amnt`)

## Примеры с ожидаемыми результатами

### Тест 1: Интеграл sqrt(x) от 0 до 4
Аналитическое решение: ∫[0,4] sqrt(x)dx = (2/3)x^(3/2) |[0,4] = (2/3)*8 = 5.333...

```bash
./itg.out cont 0 4 0.01
# Ожидаемый результат: ~5.33
```

### Тест 2: Интеграл sqrt(x) от 1 до 9
Аналитическое решение: ∫[1,9] sqrt(x)dx = (2/3)x^(3/2) |[1,9] = (2/3)*(27 - 1) = 17.333...

```bash
./itg.out cont 1 9 0.001
# Ожидаемый результат: ~17.33
```

### Тест 3: Дискретные данные
```bash
./itg.out 3 0 1 2 0 1 1.414 1 3 0.01
# Интегрируем от x=0 до x=2 (индексы 1-3)
# Ожидаемый результат: близко к аналитическому
```

## Изменение количества потоков

Чтобы изменить количество потоков, отредактируйте константу в начале файла:

```c
const int pthread_amnt = 3;  // Измените на нужное количество
```

## Защита от зацикливания

Программа содержит несколько уровней защиты:
1. Проверка корректности входных данных
2. Ограничение максимального количества итераций
3. Проверка валидности шага интегрирования
4. Минимальный размер подотрезка для каждого потока

## Отладочная информация

Программа выводит отладочную информацию:
- Границы интегрирования для каждого потока
- Вычисленный шаг интегрирования `h`
- Промежуточные значения (можно отключить, удалив `printf`)

## Функция для интегрирования

По умолчанию используется функция:
```c
double f(double x) {
    return sqrt(x);
}
```

Чтобы изменить функцию, отредактируйте это определение в коде.

## Технические детали

- **Язык**: C
- **Библиотеки**: pthread, math
- **Стандарт**: C99+
- **Платформа**: POSIX-совместимые системы (Linux, macOS)

